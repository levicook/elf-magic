#!/bin/bash
set -euo pipefail

# Parse ecosystem tag format: ecosystem/solana-spl-token/v3.4.0
# Usage: ./scripts/parse-ecosystem-tag.sh <tag>

if [ $# -ne 1 ]; then
    echo "Usage: $0 <tag>" >&2
    echo "Example: $0 ecosystem/solana-spl-token/v3.4.0" >&2
    exit 1
fi

TAG="$1"
echo "Full tag: $TAG" >&2

# Extract ecosystem name (solana-spl-token)
ECOSYSTEM_NAME=$(echo "$TAG" | cut -d'/' -f2)

# Extract version (3.4.0)
VERSION=$(echo "$TAG" | cut -d'/' -f3 | sed 's/^v//')

# Generate package name (elf-magic-solana-spl-token)
PACKAGE_NAME="elf-magic-$ECOSYSTEM_NAME"

# Generate manifest path
MANIFEST_PATH="ecosystem/$ECOSYSTEM_NAME/Cargo.toml"

echo "ECOSYSTEM_NAME=$ECOSYSTEM_NAME"
echo "VERSION=$VERSION"
echo "PACKAGE_NAME=$PACKAGE_NAME"
echo "MANIFEST_PATH=$MANIFEST_PATH"

echo "Parsed - Ecosystem: $ECOSYSTEM_NAME, Package: $PACKAGE_NAME, Version: $VERSION, Manifest: $MANIFEST_PATH" >&2 